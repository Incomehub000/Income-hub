<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â - INCOME HUB</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .admin-container { display: flex; min-height: 100vh; }
        .admin-sidebar { width: 280px; background: linear-gradient(135deg, #2c3e50, #34495e); color: white; position: fixed; height: 100vh; overflow-y: auto; z-index: 1000; }
        .admin-sidebar-header { padding: 25px 20px; text-align: center; border-bottom: 1px solid #40566b; background: rgba(255,255,255,0.05); }
        .admin-sidebar-header h2 { margin: 0; font-size: 1.5rem; color: #e74c3c; }
        .admin-sidebar-header p { margin: 5px 0 0 0; font-size: 0.9rem; opacity: 0.8; }
        .admin-sidebar-menu { list-style: none; padding: 0; margin: 0; }
        .admin-sidebar-menu li { border-bottom: 1px solid #40566b; }
        .admin-sidebar-menu a { display: flex; align-items: center; color: white; text-decoration: none; padding: 18px 25px; transition: all 0.3s; border-left: 4px solid transparent; }
        .admin-sidebar-menu a:hover { background: rgba(231, 76, 60, 0.1); border-left-color: #e74c3c; padding-left: 30px; }
        .admin-sidebar-menu a.active { background: rgba(231, 76, 60, 0.2); border-left-color: #e74c3c; color: #e74c3c; }
        .admin-menu-icon { margin-right: 15px; font-size: 1.3rem; width: 25px; text-align: center; }
        .admin-main-content { flex: 1; margin-left: 280px; padding: 0; background: #f8f9fa; min-height: 100vh; }
        .admin-top-bar { background: white; padding: 20px 30px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .admin-content-area { padding: 30px; }
        .page-header { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 25px 30px; border-radius: 15px; margin-bottom: 30px; }
        .stats-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; text-align: center; border-left: 4px solid #f39c12; }
        .stat-card.pending { border-left-color: #f39c12; }
        .stat-card.approved { border-left-color: #27ae60; }
        .stat-card.rejected { border-left-color: #e74c3c; }
        .stat-number { font-size: 2rem; font-weight: bold; color: #2c3e50; margin: 10px 0; }
        .task-controls { display: grid; grid-template-columns: 1fr auto auto; gap: 15px; margin-bottom: 25px; align-items: center; }
        .search-box { position: relative; }
        .search-box input { width: 100%; padding: 12px 45px 12px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .search-box input:focus { border-color: #667eea; outline: none; }
        .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #666; }
        .filter-btn, .export-btn { background: white; border: 2px solid #ddd; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .filter-btn:hover, .export-btn:hover { border-color: #667eea; color: #667eea; }
        .tasks-table { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .table-header { background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 20px; display: grid; grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr 1.5fr; gap: 15px; font-weight: bold; }
        .table-row { display: grid; grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr 1.5fr; gap: 15px; padding: 15px 20px; border-bottom: 1px solid #eee; align-items: center; }
        .table-row:hover { background: #f8f9fa; }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; text-align: center; }
        .status-pending { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status-approved { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-rejected { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .action-buttons { display: flex; gap: 8px; }
        .btn-approve, .btn-reject, .btn-view { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600; }
        .btn-approve { background: #27ae60; color: white; }
        .btn-reject { background: #e74c3c; color: white; }
        .btn-view { background: #3498db; color: white; }
        .btn-approve:hover, .btn-reject:hover, .btn-view:hover { opacity: 0.9; transform: translateY(-2px); }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .user-details { flex: 1; }
        .user-name { font-weight: 600; color: #333; }
        .user-email { font-size: 0.8rem; color: #666; }
        .empty-state { text-align: center; padding: 60px 20px; color: #666; }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-sidebar">
            <div class="admin-sidebar-header"><h2>INCOME HUB</h2><p>‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</p></div>
            <ul class="admin-sidebar-menu">
                <li><a href="admin-dashboard.html"><span class="admin-menu-icon">üìä</span> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</a></li>
                <li><a href="admin-users.html"><span class="admin-menu-icon">üë•</span> ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</a></li>
                <li><a href="admin-staff.html"><span class="admin-menu-icon">üëë</span> ‡¶∏‡ßç‡¶ü‡¶æ‡¶´ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</a></li>
                <li><a href="admin-tasks.html" class="active"><span class="admin-menu-icon">üìã</span> ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</a></li>
                <li><a href="admin-deposits.html"><span class="admin-menu-icon">üí∞</span> ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü</a></li>
                <li><a href="admin-withdrawals.html"><span class="admin-menu-icon">üí≥</span> ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü</a></li>
                <li><a href="admin-reports.html"><span class="admin-menu-icon">üìà</span> ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶∏</a></li>
                <li><a href="admin-settings.html"><span class="admin-menu-icon">‚öôÔ∏è</span> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</a></li>
                <li><a href="javascript:void(0)" onclick="adminLogout()"><span class="admin-menu-icon">üö™</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</a></li>
            </ul>
        </div>
        
        <div class="admin-main-content">
            <div class="admin-top-bar">
                <div class="website-name"><span>INCOME HUB</span><span style="font-size: 1rem; opacity: 0.7;">- ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</span></div>
                <div class="user-info"><span id="adminWelcome">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span><span class="role-badge" id="adminRoleBadge">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</span></div>
            </div>
            
            <div class="page-header">
                <h1 style="margin: 0 0 10px 0; font-size: 2rem;">üìã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</h1>
                <p style="margin: 0; font-size: 1.1rem; opacity: 0.9;">‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
            
            <div class="admin-content-area">
                <div class="stats-cards">
                    <div class="stat-card"><h3>‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3><div class="stat-number" id="totalTasks">0</div><p>‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶®</p></div>
                    <div class="stat-card pending"><h3>‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç</h3><div class="stat-number" id="pendingTasks">0</div><p>‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</p></div>
                    <div class="stat-card approved"><h3>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶°</h3><div class="stat-number" id="approvedTasks">0</div><p>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p></div>
                    <div class="stat-card rejected"><h3>‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°</h3><div class="stat-number" id="rejectedTasks">0</div><p>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</p></div>
                </div>
                
                <div class="task-controls">
                    <div class="search-box"><input type="text" id="taskSearch" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡¶æ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..."><span class="search-icon">üîç</span></div>
                    <button class="filter-btn" onclick="showTaskFilters()"><span>üîß</span> ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞</button>
                    <button class="export-btn" onclick="exportTasks()"><span>üì§</span> ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
                </div>
                
                <div class="tasks-table">
                    <div class="table-header">
                        <div>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ì ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</div><div>‡¶ï‡¶Ø‡¶º‡ßá‡¶®</div><div>‡¶ü‡¶æ‡¶ï‡¶æ</div><div>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</div><div>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</div><div>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</div>
                    </div>
                    <div id="tasksTable"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const COIN_RATE = 10;
        
        document.addEventListener('DOMContentLoaded', function() {
            const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));
            if (!currentAdmin) { alert('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!'); window.location.href = 'admin-login.html'; return; }
            updateAdminData(currentAdmin);
            loadTasksData();
            updateTaskStats();
        });
        
        function updateAdminData(admin) {
            document.getElementById('adminWelcome').textContent = `‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, ${admin.fullName}!`;
            const roleNames = {'super_admin': '‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶®','admin': '‡¶è‡¶°‡¶Æ‡¶ø‡¶®','moderator': '‡¶Æ‡¶°‡¶æ‡¶∞‡ßá‡¶ü‡¶∞','support': '‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü'};
            const roleBadge = document.getElementById('adminRoleBadge');
            roleBadge.textContent = roleNames[admin.role] || admin.role;
            roleBadge.className = `role-badge role-${admin.role}`;
        }
        
        function loadTasksData() {
            const taskSubmissions = JSON.parse(localStorage.getItem('adminTaskSubmissions') || '[]');
            const users = JSON.parse(localStorage.getItem('incomeHubUsers') || '[]');
            const tasksTable = document.getElementById('tasksTable');
            
            let tableHtml = '';
            if (taskSubmissions.length === 0) {
                tableHtml = `<div class="empty-state"><div>üìã</div><h3>‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶∂‡¶® ‡¶®‡ßá‡¶á</h3><p>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶∞‡¶æ ‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßá‡¶®‡¶ø</p></div>`;
            } else {
                taskSubmissions.forEach(task => {
                    const user = users.find(u => u.id === task.userId) || {};
                    const moneyAmount = task.coins / COIN_RATE;
                    const statusClass = `status-${task.status}`;
                    const statusText = getStatusText(task.status);
                    
                    tableHtml += `
                        <div class="table-row">
                            <div class="user-info">
                                <div class="user-avatar">${user.name ? user.name.charAt(0).toUpperCase() : 'U'}</div>
                                <div class="user-details">
                                    <div class="user-name">${user.name || '‡¶®‡¶æ‡¶Æ ‡¶®‡ßá‡¶á'} - ${task.taskName}</div>
                                    <div class="user-email">${task.description || '‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶®‡ßá‡¶á'}</div>
                                </div>
                            </div>
                            <div>${task.coins} ‡¶ï‡¶Ø‡¶º‡ßá‡¶®</div>
                            <div>${moneyAmount.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ</div>
                            <div>${new Date(task.submissionDate).toLocaleDateString('bn-BD')}</div>
                            <div><span class="status-badge ${statusClass}">${statusText}</span></div>
                            <div class="action-buttons">
                                ${task.status === 'pending' ? `
                                    <button class="btn-approve" onclick="approveTask('${task.id}')">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠</button>
                                    <button class="btn-reject" onclick="rejectTask('${task.id}')">‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü</button>
                                ` : ''}
                                <button class="btn-view" onclick="viewTask('${task.id}')">‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                            </div>
                        </div>
                    `;
                });
            }
            tasksTable.innerHTML = tableHtml;
        }
        
        function updateTaskStats() {
            const taskSubmissions = JSON.parse(localStorage.getItem('adminTaskSubmissions') || '[]');
            document.getElementById('totalTasks').textContent = taskSubmissions.length;
            document.getElementById('pendingTasks').textContent = taskSubmissions.filter(t => t.status === 'pending').length;
            document.getElementById('approvedTasks').textContent = taskSubmissions.filter(t => t.status === 'approved').length;
            document.getElementById('rejectedTasks').textContent = taskSubmissions.filter(t => t.status === 'rejected').length;
        }
        
        function getStatusText(status) {
            const statusMap = {'pending': '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç','approved': '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠‡¶°','rejected': '‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°'};
            return statusMap[status] || status;
        }
        
        function approveTask(taskId) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                const taskSubmissions = JSON.parse(localStorage.getItem('adminTaskSubmissions') || '[]');
                const users = JSON.parse(localStorage.getItem('incomeHubUsers') || '[]');
                const taskIndex = taskSubmissions.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    const task = taskSubmissions[taskIndex];
                    const userIndex = users.findIndex(u => u.id === task.userId);
                    if (userIndex !== -1) {
                        users[userIndex].balance = (users[userIndex].balance || 0) + task.coins;
                        users[userIndex].completedTasks = (users[userIndex].completedTasks || 0) + 1;
                        users[userIndex].totalEarned = (users[userIndex].totalEarned || 0) + task.coins;
                    }
                    taskSubmissions[taskIndex].status = 'approved';
                    taskSubmissions[taskIndex].approvedDate = new Date().toISOString();
                    taskSubmissions[taskIndex].approvedBy = JSON.parse(localStorage.getItem('currentAdmin')).id;
                    localStorage.setItem('adminTaskSubmissions', JSON.stringify(taskSubmissions));
                    localStorage.setItem('incomeHubUsers', JSON.stringify(users));
                    loadTasksData();
                    updateTaskStats();
                    alert('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶∞‡ßÅ‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
            }
        }
        
        function rejectTask(taskId) {
            const reason = prompt('‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:');
            if (reason !== null) {
                const taskSubmissions = JSON.parse(localStorage.getItem('adminTaskSubmissions') || '[]');
                const taskIndex = taskSubmissions.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    taskSubmissions[taskIndex].status = 'rejected';
                    taskSubmissions[taskIndex].rejectedDate = new Date().toISOString();
                    taskSubmissions[taskIndex].rejectedBy = JSON.parse(localStorage.getItem('currentAdmin')).id;
                    taskSubmissions[taskIndex].rejectionReason = reason;
                    localStorage.setItem('adminTaskSubmissions', JSON.stringify(taskSubmissions));
                    loadTasksData();
                    updateTaskStats();
                    alert('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                }
            }
        }
        
        function viewTask(taskId) { alert(`‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ID: ${taskId} ‡¶è‡¶∞ ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá`); }
        function showTaskFilters() { alert('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá'); }
        function exportTasks() { alert('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...'); }
        function adminLogout() {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                localStorage.removeItem('currentAdmin');
                alert('‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶´‡¶≤!');
                window.location.href = 'admin-login.html';
            }
        }
    </script>
</body>
</html>
